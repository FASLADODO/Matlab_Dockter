%Make UR-5 according to:
% http://www.universal-robots.com/how-tos-and-faqs/faq/ur-faq/actual-center-of-mass-for-robot-17264/
clear all

%theta,d,a,alpha (DH convention) (units = meters)
L(1) = Link([0,  0.089459,        0,  pi/2   ]); %link 1
L(2) = Link([0,         0, -0.42500,     0   ]); %link 2
L(3) = Link([0,         0, -0.39225,     0   ]); %link 3
L(4) = Link([0,   0.10915,        0,  pi/2   ]); %link 4
L(5) = Link([0,   0.09465,        0, -pi/2   ]); %link 5
L(6) = Link([0,    0.0823,        0,     0   ]); %link 6 

%create robot
UR5 = SerialLink(L, 'name', 'UR5');

%zero pose
%[theta1, theta2, theta3, theta4, theta5,theta6];
qzp = [0,0,0,0,0,0]; 

%plot the robot in the zero position (different than home)
UR5.plot(qzp)

%get xyz at zero from forward kinematics
pos_zero = UR5.fkine(qzp)

%% Try putting it in the home position

%offset for home position
home_position = [0,-pi/2,0,-pi/2,0,0];
qhome = qzp + home_position;

%plot the robot in the home position
UR5.plot(qhome)


%% try forward kinematics and jacobians

%get xyz at home from forward kinematics
pos_home = UR5.fkine(qhome)

qtest = [0,0,-pi/2,-pi/2,0,0];
J = UR5.jacobn(qtest)
jinv = inv(J)

%get jacobian in home position v=J(q)*qdot
J = UR5.jacobn(qhome)

%example joint velocities
qdot = [1,1,0,0,0,0]; %radians / second?
V = J*qdot'

%% symbolic forward kinematics

syms th1 th2 th3 th4 th5 th6
assume(th1,'real')
assume(th2,'real')
assume(th3,'real')
assume(th4,'real')
assume(th5,'real')
assume(th6,'real')
qsym = [th1,th2,th3,th4,th5,th6];
fk_sym = UR5.fkine(qsym)

fk_sym = simplify(fk_sym);
fk_sym = simplify(fk_sym);

vpa(fk_sym,5)
%% Compute inverse kinematics

P = [0.2;0.2;0.5]; %position x;y;z
%R = eul2r(0.0,0.0,0.0);
R = rpy2r(0.1,0.1,0.1);
% R = [1,0,0;0,1,0;0,0,1]; %rotation
T_New = [R,P; 0,0,0,1] %Transformation matrix

eulz = tr2rpy(R)

%get joinst angles
% qik = UR5.ikine6s(T_New) CANT USE THIS, NO SPHERICAL WRIST
qik = UR5.ikine(T_New)

%plot new robot configuration
UR5.plot(qik)

%% Trying trajectories

t = 0:0.2:3; %take 3 seconds

%create trajectory
Ts = ctraj(pos_home,T_New,length(t));

%do ik for all points in trajectory
qc = UR5.ikine(Ts);

UR5.plot(qhome)
%now loop through all configurations and plot robot with pauses
for ii =1:length(t)
     qcurrent = qc(ii,:);
     UR5.plot(qcurrent)
     pause(0.2);
end


%% now try symbolic jacobian
syms th1 th2 th3 th4 th5 th6
assume(th1,'real')
assume(th2,'real')
assume(th3,'real')
assume(th4,'real')
assume(th5,'real')
assume(th6,'real')
qsym = [th1,th2,th3,th4,th5,th6];
Jsym = UR5.jacobn(qsym);
%%
Jsym_vpa=vpa(Jsym,5);
%%
Jsym_eps=simplify_eps(Jsym_vpa);

%%
%This is crazy slow
Jsym_vpa = simplify(Jsym_vpa);
Jsym_vpa = simplify(Jsym_vpa);
pretty(Jsym_vpa)
%%
J_hacky=[...
[                                                                                                                                                                                                                                                                                                                                       (cos(th1)*(0.08230000000000359250407200306654*cos(th5) + 0.1091499999999996362021192908287) + sin(th1)*(0.041150000000001798771746790779082*sin(th2 + th3 + th4 + th5) - 0.094650000000001455191522836685181*sin(th2 + th3 + th4) - 0.041150000000001793732325212287457*sin(th2 + th3 + th4 - th5) + 0.39224999999998999555828049778938*cos(th2 + th3) + 0.42500000000001136868377216160297*cos(th2)) + cos(th1)*(0*0000000000057956409769649299911726059006546*cos(th2 + th3 + th4) - 0*000000000002519710789245785816272753614744*cos(th2 + th3 + th4 + th5) + 0*000000000024018385348276818336337268069364*sin(th2 + th3) + 0*00000000002602374448188191511384594930026*sin(th2) + 0*0000000000025197107892457855076971783320509*cos(th2 + th3 + th4 - th5)))*(0*000000000061232339957367574077026692924754*sin(th1)*(sin(th2)*(sin(th3)*(cos(th4)*sin(th6) - 0*000000000061232339957367573999999946028727*sin(th4)*sin(th5)*sin(th6) + 3.7493994566546336e-33*cos(th4)*cos(th5)*sin(th6) + 0*000000000061232339957367574077026692924754*cos(th4)*cos(th6)*sin(th5) + cos(th5)*cos(th6)*sin(th4)) + cos(th3)*(sin(th4)*sin(th6) + 0*000000000061232339957367574*cos(th4)*sin(th5)*sin(th6) + 3.7493994566546336e-33*cos(th5)*sin(th4)*sin(th6) + 0*000000000061232339957367574077026692924754*cos(th6)*sin(th4)*sin(th5) - 1.0*cos(th4)*cos(th5)*cos(th6))) - cos(th2)*(cos(th3)*(cos(th4)*sin(th6) - 0*000000000061232339957367573999999946028727*sin(th4)*sin(th5)*sin(th6) + 3.7493994566546336e-33*cos(th4)*cos(th5)*sin(th6) + 0*000000000061232339957367574077026692924754*cos(th4)*cos(th6)*sin(th5) + cos(th5)*cos(th6)*sin(th4)) - 1.0*sin(th3)*(sin(th4)*sin(th6) + 0*000000000061232339957367574*cos(th4)*sin(th5)*sin(th6) + 3.7493994566546336e-33*cos(th5)*sin(th4)*sin(th6) + 0*000000000061232339957367574077026692924754*cos(th6)*sin(th4)*sin(th5) - 1.0*cos(th4)*cos(th5)*cos(th6)))) - cos(th1)*(cos(th2)*(sin(th3)*(cos(th4)*sin(th6) - 0*000000000061232339957367573999999946028727*sin(th4)*sin(th5)*sin(th6) + 3.7493994566546336e-33*cos(th4)*cos(th5)*sin(th6) + 0*000000000061232339957367574077026692924754*cos(th4)*cos(th6)*sin(th5) + cos(th5)*cos(th6)*sin(th4)) + cos(th3)*(sin(th4)*sin(th6) + 0*000000000061232339957367574*cos(th4)*sin(th5)*sin(th6) + 3.7493994566546336e-33*cos(th5)*sin(th4)*sin(th6) + 0*000000000061232339957367574077026692924754*cos(th6)*sin(th4)*sin(th5) - 1.0*cos(th4)*cos(th5)*cos(th6))) + sin(th2)*(cos(th3)*(cos(th4)*sin(th6) - 0*000000000061232339957367573999999946028727*sin(th4)*sin(th5)*sin(th6) + 3.7493994566546336e-33*cos(th4)*cos(th5)*sin(th6) + 0*000000000061232339957367574077026692924754*cos(th4)*cos(th6)*sin(th5) + cos(th5)*cos(th6)*sin(th4)) - 1.0*sin(th3)*(sin(th4)*sin(th6) + 0*000000000061232339957367574*cos(th4)*sin(th5)*sin(th6) + 3.7493994566546336e-33*cos(th5)*sin(th4)*sin(th6) + 0*000000000061232339957367574077026692924754*cos(th6)*sin(th4)*sin(th5) - 1.0*cos(th4)*cos(th5)*cos(th6)))) + sin(th1)*(0*000000000061232339957367574077026692924754*cos(th5)*sin(th6) - 0*000000000061232339957367574077026692924754*sin(th6) + cos(th6)*sin(th5))) - 1.0*(0*000000000061232339957367574077026692924754*cos(th1)*(sin(th2)*(sin(th3)*(cos(th4)*sin(th6) - 0*000000000061232339957367573999999946028727*sin(th4)*sin(th5)*sin(th6) + 3.7493994566546336e-33*cos(th4)*cos(th5)*sin(th6) + 0*000000000061232339957367574077026692924754*cos(th4)*cos(th6)*sin(th5) + cos(th5)*cos(th6)*sin(th4)) + cos(th3)*(sin(th4)*sin(th6) + 0*000000000061232339957367574*cos(th4)*sin(th5)*sin(th6) + 3.7493994566546336e-33*cos(th5)*sin(th4)*sin(th6) + 0*000000000061232339957367574077026692924754*cos(th6)*sin(th4)*sin(th5) - 1.0*cos(th4)*cos(th5)*cos(th6))) - cos(th2)*(cos(th3)*(cos(th4)*sin(th6) - 0*000000000061232339957367573999999946028727*sin(th4)*sin(th5)*sin(th6) + 3.7493994566546336e-33*cos(th4)*cos(th5)*sin(th6) + 0*000000000061232339957367574077026692924754*cos(th4)*cos(th6)*sin(th5) + cos(th5)*cos(th6)*sin(th4)) - 1.0*sin(th3)*(sin(th4)*sin(th6) + 0*000000000061232339957367574*cos(th4)*sin(th5)*sin(th6) + 3.7493994566546336e-33*cos(th5)*sin(th4)*sin(th6) + 0*000000000061232339957367574077026692924754*cos(th6)*sin(th4)*sin(th5) - 1.0*cos(th4)*cos(th5)*cos(th6)))) + sin(th1)*(cos(th2)*(sin(th3)*(cos(th4)*sin(th6) - 0*000000000061232339957367573999999946028727*sin(th4)*sin(th5)*sin(th6) + 3.7493994566546336e-33*cos(th4)*cos(th5)*sin(th6) + 0*000000000061232339957367574077026692924754*cos(th4)*cos(th6)*sin(th5) + cos(th5)*cos(th6)*sin(th4)) + cos(th3)*(sin(th4)*sin(th6) + 0*000000000061232339957367574*cos(th4)*sin(th5)*sin(th6) + 3.7493994566546336e-33*cos(th5)*sin(th4)*sin(th6) + 0*000000000061232339957367574077026692924754*cos(th6)*sin(th4)*sin(th5) - 1.0*cos(th4)*cos(th5)*cos(th6))) + sin(th2)*(cos(th3)*(cos(th4)*sin(th6) - 0*000000000061232339957367573999999946028727*sin(th4)*sin(th5)*sin(th6) + 3.7493994566546336e-33*cos(th4)*cos(th5)*sin(th6) + 0*000000000061232339957367574077026692924754*cos(th4)*cos(th6)*sin(th5) + cos(th5)*cos(th6)*sin(th4)) - 1.0*sin(th3)*(sin(th4)*sin(th6) + 0*000000000061232339957367574*cos(th4)*sin(th5)*sin(th6) + 3.7493994566546336e-33*cos(th5)*sin(th4)*sin(th6) + 0*000000000061232339957367574077026692924754*cos(th6)*sin(th4)*sin(th5) - 1.0*cos(th4)*cos(th5)*cos(th6)))) + cos(th1)*(0*000000000061232339957367574077026692924754*cos(th5)*sin(th6) - 0*000000000061232339957367574077026692924754*sin(th6) + cos(th6)*sin(th5)))*(sin(th1)*(0.08230000000000359250407200306654*cos(th5) + 0.1091499999999996362021192908287) - cos(th1)*(0.041150000000001798771746790779082*sin(th2 + th3 + th4 + th5) - 0.094650000000001455191522836685181*sin(th2 + th3 + th4) - 0.041150000000001793732325212287457*sin(th2 + th3 + th4 - th5) + 0.39224999999998999555828049778938*cos(th2 + th3) + 0.42500000000001136868377216160297*cos(th2)) + sin(th1)*(0*0000000000057956409769649299911726059006546*cos(th2 + th3 + th4) - 0*000000000002519710789245785816272753614744*cos(th2 + th3 + th4 + th5) + 0*000000000024018385348276818336337268069364*sin(th2 + th3) + 0*00000000002602374448188191511384594930026*sin(th2) + 0*0000000000025197107892457855076971783320509*cos(th2 + th3 + th4 - th5))), 0.094650000000001455191522836685181*cos(th5)*cos(th6) - 0*0000000000050394215784916252390455895630061*cos(th6) - 0.39224999999998999555828049778938*cos(th4)*sin(th6) - 0.08230000000000359250407200306654*sin(th5)*sin(th6) + 0.42500000000001136868377216160297*sin(th3)*sin(th4)*sin(th6) + 0*000000000024018385348276802998433164374337*sin(th4)*sin(th5)*sin(th6) - 0.42500000000001136868377216160297*cos(th3)*cos(th4)*sin(th6) - 1.4707019368727018656640830571442e-33*cos(th4)*cos(th5)*sin(th6) - 0*000000000024018385348276802998433164374337*cos(th4)*cos(th6)*sin(th5) - 0.39224999999998999555828049778938*cos(th5)*cos(th6)*sin(th4) - 1.5934947690782859730520358531796e-33*cos(th3)*cos(th4)*cos(th5)*sin(th6) - 0*000000000026023744481882165615822609707187*cos(th3)*cos(th4)*cos(th6)*sin(th5) - 0.42500000000001136868377216160297*cos(th3)*cos(th5)*cos(th6)*sin(th4) - 0.42500000000001136868377216160297*cos(th4)*cos(th5)*cos(th6)*sin(th3) + 0*000000000026023744481882165615822609707187*cos(th3)*sin(th4)*sin(th5)*sin(th6) + 0*000000000026023744481882165615822609707187*cos(th4)*sin(th3)*sin(th5)*sin(th6) + 1.5934947690782859730520358531796e-33*cos(th5)*sin(th3)*sin(th4)*sin(th6) + 0*000000000026023744481882165615822609707187*cos(th6)*sin(th3)*sin(th4)*sin(th5), 0.094650000000001455191522836685181*cos(th5)*cos(th6) - 0*0000000000050394215784916252390455895630061*cos(th6) - 0.39224999999998999555828049778938*cos(th4)*sin(th6) - 0.08230000000000359250407200306654*sin(th5)*sin(th6) + 0*000000000024018385348276802998433164374337*sin(th4)*sin(th5)*sin(th6) - 1.4707019368727018656640830571442e-33*cos(th4)*cos(th5)*sin(th6) - 0*000000000024018385348276802998433164374337*cos(th4)*cos(th6)*sin(th5) - 0.39224999999998999555828049778938*cos(th5)*cos(th6)*sin(th4), 0.094650000000001455191522836685181*cos(th5)*cos(th6) - 0*0000000000050394215784916252390455895630061*cos(th6) - 0.08230000000000359250407200306654*sin(th5)*sin(th6),       -0.08230000000000359250407200306654*cos(th6),   0];...
[ - (cos(th1)*(cos(th2)*(cos(th3)*(cos(th6)*sin(th4) - 0*000000000061232339957367574077026692924754*sin(th4)*sin(th5)*sin(th6) + cos(th4)*cos(th5)*sin(th6) + 0*000000000061232339957367574077026692924754*cos(th4)*cos(th6)*sin(th5) + 3.749399456654633603536893040566e-33*cos(th5)*cos(th6)*sin(th4)) - sin(th3)*(0*000000000061232339957367574077026692924754*cos(th4)*sin(th5)*sin(th6) - 1.0*cos(th4)*cos(th6) + cos(th5)*sin(th4)*sin(th6) + 0*000000000061232339957367574077026692924754*cos(th6)*sin(th4)*sin(th5) - 3.749399456654633603536893040566e-33*cos(th4)*cos(th5)*cos(th6))) - sin(th2)*(sin(th3)*(cos(th6)*sin(th4) - 0*000000000061232339957367574077026692924754*sin(th4)*sin(th5)*sin(th6) + cos(th4)*cos(th5)*sin(th6) + 0*000000000061232339957367574077026692924754*cos(th4)*cos(th6)*sin(th5) + 3.749399456654633603536893040566e-33*cos(th5)*cos(th6)*sin(th4)) + cos(th3)*(0*000000000061232339957367574077026692924754*cos(th4)*sin(th5)*sin(th6) - 1.0*cos(th4)*cos(th6) + cos(th5)*sin(th4)*sin(th6) + 0*000000000061232339957367574077026692924754*cos(th6)*sin(th4)*sin(th5) - 3.749399456654633603536893040566e-33*cos(th4)*cos(th5)*cos(th6)))) - 0*000000000061232339957367574077026692924754*sin(th1)*(cos(th2)*(sin(th3)*(cos(th6)*sin(th4) - 0*000000000061232339957367574077026692924754*sin(th4)*sin(th5)*sin(th6) + cos(th4)*cos(th5)*sin(th6) + 0*000000000061232339957367574077026692924754*cos(th4)*cos(th6)*sin(th5) + 3.749399456654633603536893040566e-33*cos(th5)*cos(th6)*sin(th4)) + cos(th3)*(0*000000000061232339957367574077026692924754*cos(th4)*sin(th5)*sin(th6) - 1.0*cos(th4)*cos(th6) + cos(th5)*sin(th4)*sin(th6) + 0*000000000061232339957367574077026692924754*cos(th6)*sin(th4)*sin(th5) - 3.749399456654633603536893040566e-33*cos(th4)*cos(th5)*cos(th6))) + sin(th2)*(cos(th3)*(cos(th6)*sin(th4) - 0*000000000061232339957367574077026692924754*sin(th4)*sin(th5)*sin(th6) + cos(th4)*cos(th5)*sin(th6) + 0*000000000061232339957367574077026692924754*cos(th4)*cos(th6)*sin(th5) + 3.749399456654633603536893040566e-33*cos(th5)*cos(th6)*sin(th4)) - sin(th3)*(0*000000000061232339957367574077026692924754*cos(th4)*sin(th5)*sin(th6) - 1.0*cos(th4)*cos(th6) + cos(th5)*sin(th4)*sin(th6) + 0*000000000061232339957367574077026692924754*cos(th6)*sin(th4)*sin(th5) - 3.749399456654633603536893040566e-33*cos(th4)*cos(th5)*cos(th6)))) + sin(th1)*(0*000000000061232339957367574077026692924754*cos(th6) - 0*000000000061232339957367574077026692924754*cos(th5)*cos(th6) + sin(th5)*sin(th6)))*(cos(th1)*(0.08230000000000359250407200306654*cos(th5) + 0.1091499999999996362021192908287) + sin(th1)*(0.041150000000001798771746790779082*sin(th2 + th3 + th4 + th5) - 0.094650000000001455191522836685181*sin(th2 + th3 + th4) - 0.041150000000001793732325212287457*sin(th2 + th3 + th4 - th5) + 0.39224999999998999555828049778938*cos(th2 + th3) + 0.42500000000001136868377216160297*cos(th2)) + cos(th1)*(0*0000000000057956409769649299911726059006546*cos(th2 + th3 + th4) - 0*000000000002519710789245785816272753614744*cos(th2 + th3 + th4 + th5) + 0*000000000024018385348276818336337268069364*sin(th2 + th3) + 0*00000000002602374448188191511384594930026*sin(th2) + 0*0000000000025197107892457855076971783320509*cos(th2 + th3 + th4 - th5))) - (0*000000000061232339957367574077026692924754*cos(th1)*(cos(th2)*(sin(th3)*(cos(th6)*sin(th4) - 0*000000000061232339957367574077026692924754*sin(th4)*sin(th5)*sin(th6) + cos(th4)*cos(th5)*sin(th6) + 0*000000000061232339957367574077026692924754*cos(th4)*cos(th6)*sin(th5) + 3.749399456654633603536893040566e-33*cos(th5)*cos(th6)*sin(th4)) + cos(th3)*(0*000000000061232339957367574077026692924754*cos(th4)*sin(th5)*sin(th6) - 1.0*cos(th4)*cos(th6) + cos(th5)*sin(th4)*sin(th6) + 0*000000000061232339957367574077026692924754*cos(th6)*sin(th4)*sin(th5) - 3.749399456654633603536893040566e-33*cos(th4)*cos(th5)*cos(th6))) + sin(th2)*(cos(th3)*(cos(th6)*sin(th4) - 0*000000000061232339957367574077026692924754*sin(th4)*sin(th5)*sin(th6) + cos(th4)*cos(th5)*sin(th6) + 0*000000000061232339957367574077026692924754*cos(th4)*cos(th6)*sin(th5) + 3.749399456654633603536893040566e-33*cos(th5)*cos(th6)*sin(th4)) - sin(th3)*(0*000000000061232339957367574077026692924754*cos(th4)*sin(th5)*sin(th6) - 1.0*cos(th4)*cos(th6) + cos(th5)*sin(th4)*sin(th6) + 0*000000000061232339957367574077026692924754*cos(th6)*sin(th4)*sin(th5) - 3.749399456654633603536893040566e-33*cos(th4)*cos(th5)*cos(th6)))) + sin(th1)*(cos(th2)*(cos(th3)*(cos(th6)*sin(th4) - 0*000000000061232339957367574077026692924754*sin(th4)*sin(th5)*sin(th6) + cos(th4)*cos(th5)*sin(th6) + 0*000000000061232339957367574077026692924754*cos(th4)*cos(th6)*sin(th5) + 3.749399456654633603536893040566e-33*cos(th5)*cos(th6)*sin(th4)) - sin(th3)*(0*000000000061232339957367574077026692924754*cos(th4)*sin(th5)*sin(th6) - 1.0*cos(th4)*cos(th6) + cos(th5)*sin(th4)*sin(th6) + 0*000000000061232339957367574077026692924754*cos(th6)*sin(th4)*sin(th5) - 3.749399456654633603536893040566e-33*cos(th4)*cos(th5)*cos(th6))) - sin(th2)*(sin(th3)*(cos(th6)*sin(th4) - 0*000000000061232339957367574077026692924754*sin(th4)*sin(th5)*sin(th6) + cos(th4)*cos(th5)*sin(th6) + 0*000000000061232339957367574077026692924754*cos(th4)*cos(th6)*sin(th5) + 3.749399456654633603536893040566e-33*cos(th5)*cos(th6)*sin(th4)) + cos(th3)*(0*000000000061232339957367574077026692924754*cos(th4)*sin(th5)*sin(th6) - 1.0*cos(th4)*cos(th6) + cos(th5)*sin(th4)*sin(th6) + 0*000000000061232339957367574077026692924754*cos(th6)*sin(th4)*sin(th5) - 3.749399456654633603536893040566e-33*cos(th4)*cos(th5)*cos(th6)))) - cos(th1)*(0*000000000061232339957367574077026692924754*cos(th6) - 0*000000000061232339957367574077026692924754*cos(th5)*cos(th6) + sin(th5)*sin(th6)))*(sin(th1)*(0.08230000000000359250407200306654*cos(th5) + 0.1091499999999996362021192908287) - cos(th1)*(0.041150000000001798771746790779082*sin(th2 + th3 + th4 + th5) - 0.094650000000001455191522836685181*sin(th2 + th3 + th4) - 0.041150000000001793732325212287457*sin(th2 + th3 + th4 - th5) + 0.39224999999998999555828049778938*cos(th2 + th3) + 0.42500000000001136868377216160297*cos(th2)) + sin(th1)*(0*0000000000057956409769649299911726059006546*cos(th2 + th3 + th4) - 0*000000000002519710789245785816272753614744*cos(th2 + th3 + th4 + th5) + 0*000000000024018385348276818336337268069364*sin(th2 + th3) + 0*00000000002602374448188191511384594930026*sin(th2) + 0*0000000000025197107892457855076971783320509*cos(th2 + th3 + th4 - th5))), 0*0000000000050394215784916252390455895630061*sin(th6) - 0.39224999999998999555828049778938*cos(th4)*cos(th6) - 0.094650000000001455191522836685181*cos(th5)*sin(th6) - 0.08230000000000359250407200306654*cos(th6)*sin(th5) + 0.42500000000001136868377216160297*cos(th6)*sin(th3)*sin(th4) + 0*000000000024018385348276802998433164374337*cos(th4)*sin(th5)*sin(th6) + 0.39224999999998999555828049778938*cos(th5)*sin(th4)*sin(th6) + 0*000000000024018385348276802998433164374337*cos(th6)*sin(th4)*sin(th5) - 0.42500000000001136868377216160297*cos(th3)*cos(th4)*cos(th6) - 1.4707019368727018656640830571442e-33*cos(th4)*cos(th5)*cos(th6) - 1.5934947690782859730520358531796e-33*cos(th3)*cos(th4)*cos(th5)*cos(th6) + 0*000000000026023744481882165615822609707187*cos(th3)*cos(th4)*sin(th5)*sin(th6) + 0.42500000000001136868377216160297*cos(th3)*cos(th5)*sin(th4)*sin(th6) + 0*000000000026023744481882165615822609707187*cos(th3)*cos(th6)*sin(th4)*sin(th5) + 0.42500000000001136868377216160297*cos(th4)*cos(th5)*sin(th3)*sin(th6) + 0*000000000026023744481882165615822609707187*cos(th4)*cos(th6)*sin(th3)*sin(th5) + 1.5934947690782859730520358531796e-33*cos(th5)*cos(th6)*sin(th3)*sin(th4) - 0*000000000026023744481882165615822609707187*sin(th3)*sin(th4)*sin(th5)*sin(th6), 0*0000000000050394215784916252390455895630061*sin(th6) - 0.39224999999998999555828049778938*cos(th4)*cos(th6) - 0.094650000000001455191522836685181*cos(th5)*sin(th6) - 0.08230000000000359250407200306654*cos(th6)*sin(th5) + 0*000000000024018385348276802998433164374337*cos(th4)*sin(th5)*sin(th6) + 0.39224999999998999555828049778938*cos(th5)*sin(th4)*sin(th6) + 0*000000000024018385348276802998433164374337*cos(th6)*sin(th4)*sin(th5) - 1.4707019368727018656640830571442e-33*cos(th4)*cos(th5)*cos(th6), 0*0000000000050394215784916252390455895630061*sin(th6) - 0.094650000000001455191522836685181*cos(th5)*sin(th6) - 0.08230000000000359250407200306654*cos(th6)*sin(th5),        0.08230000000000359250407200306654*sin(th6),   0];...
[                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   0.0072499999999999786837179271969944*sin(th2 + th3 + th4 - th5) + 0.21250000000000568434188608080149*cos(th2 - th5) + 0*000000000012009192674138401499216582187169*cos(th4 - th5) + 0.19612499999999499777914024889469*cos(th2 + th3 + th5) - 0*000000000013011872240941082807911304853593*cos(th3 + th4 + th5) + 0*0000000000066835099063469275636182034941807*sin(th2 + th3 + th4) + 0.19612499999999499777914024889469*cos(th2 + th3 - th5) + 0*000000000013011872240941082807911304853593*cos(th3 + th4 - th5) - 0.10190000000000054569682106375694*sin(th2 + th3 + th4 + th5) + 1.4707019368727018656640830571443e-33*cos(th2 + th3) + 0.21250000000000568434188608080149*cos(th2 + th5) + 1.5934947690782859730520358531796e-33*cos(th3 + th4) - 0*000000000012009192674138401499216582187169*cos(th4 + th5) + 1.5934947690782859730520358531796e-33*cos(th2) + 1.4707019368727018656640830571443e-33*cos(th4) - 0*0000000000057956409769649967653054481572607*sin(th5),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     0*000000000024018385348276802998433164374338*cos(th4) - 0.094650000000001455191522836685181*sin(th5) + 0*000000000026023744481882165615822609707187*cos(th3)*cos(th4) - 0*000000000026023744481882165615822609707187*sin(th3)*sin(th4) + 0.39224999999998999555828049778938*sin(th4)*sin(th5) + 0.42500000000001136868377216160297*cos(th3)*sin(th4)*sin(th5) + 0.42500000000001136868377216160297*cos(th4)*sin(th3)*sin(th5),                                                                                                                                                                                                                                                                                              0*000000000024018385348276802998433164374337*cos(th4) - 0.094650000000001455191522836685181*sin(th5) - 0*000000000024018385348276802998433164374337*cos(th4)*cos(th5) + 0.39224999999998999555828049778938*sin(th4)*sin(th5),                                                                                                                               -0.094650000000001455191522836685181*sin(th5),                                                  0,   0];...
[                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       3.7493994566544195928818807323743e-33*cos(th5)*sin(th6) - 3.7493994566544195928818807323743e-33*sin(th6) + 0*000000000061232339957367574077026692924754*cos(th6)*sin(th5) - 1.0*sin(th2)*(sin(th3)*(0*000000000061232339957367574077026692924754*cos(th4)*(0*000000000061232339957367574077026692924754*cos(th5)*sin(th6) + cos(th6)*sin(th5)) + cos(th4)*sin(th6) + sin(th4)*(cos(th5)*cos(th6) - 0*000000000061232339957367574077026692924754*sin(th5)*sin(th6))) + cos(th3)*(0*000000000061232339957367574077026692924754*sin(th4)*(0*000000000061232339957367574077026692924754*cos(th5)*sin(th6) + cos(th6)*sin(th5)) - 1.0*cos(th4)*(cos(th5)*cos(th6) - 0*000000000061232339957367574077026692924754*sin(th5)*sin(th6)) + sin(th4)*sin(th6))) + cos(th2)*(cos(th3)*(0*000000000061232339957367574077026692924754*cos(th4)*(0*000000000061232339957367574077026692924754*cos(th5)*sin(th6) + cos(th6)*sin(th5)) + cos(th4)*sin(th6) + sin(th4)*(cos(th5)*cos(th6) - 0*000000000061232339957367574077026692924754*sin(th5)*sin(th6))) - 1.0*sin(th3)*(0*000000000061232339957367574077026692924754*sin(th4)*(0*000000000061232339957367574077026692924754*cos(th5)*sin(th6) + cos(th6)*sin(th5)) - 1.0*cos(th4)*(cos(th5)*cos(th6) - 0*000000000061232339957367574077026692924754*sin(th5)*sin(th6)) + sin(th4)*sin(th6))),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              0*000000000061232339957367574077026692924754*cos(th5)*sin(th6) - 0*000000000061232339957367574077026692924754*sin(th6) + cos(th6)*sin(th5),                                                                                                                                                                                                                                                                                                                                                                                0*000000000061232339957367574077026692924754*cos(th5)*sin(th6) - 0*000000000061232339957367574077026692924754*sin(th6) + cos(th6)*sin(th5),                      0*000000000061232339957367574077026692924754*cos(th5)*sin(th6) - 0*000000000061232339957367574077026692924754*sin(th6) + cos(th6)*sin(th5),                                      -1.0*sin(th6),   0];...
[                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   3.7493994566544195928818807323743e-33*cos(th5)*cos(th6) - 3.7493994566544195928818807323743e-33*cos(th6) - 1.0*cos(th2)*(sin(th3)*(cos(th4)*(cos(th5)*sin(th6) + 0*000000000061232339957367574077026692924754*cos(th6)*sin(th5)) + cos(th6)*sin(th4) + 0*000000000061232339957367574077026692924754*sin(th4)*(0*000000000061232339957367574077026692924754*cos(th5)*cos(th6) - 1.0*sin(th5)*sin(th6))) - 1.0*cos(th3)*(cos(th4)*cos(th6) - 1.0*sin(th4)*(cos(th5)*sin(th6) + 0*000000000061232339957367574077026692924754*cos(th6)*sin(th5)) + 0*000000000061232339957367574077026692924754*cos(th4)*(0*000000000061232339957367574077026692924754*cos(th5)*cos(th6) - 1.0*sin(th5)*sin(th6)))) - 0*000000000061232339957367574077026692924754*sin(th5)*sin(th6) - 1.0*sin(th2)*(cos(th3)*(cos(th4)*(cos(th5)*sin(th6) + 0*000000000061232339957367574077026692924754*cos(th6)*sin(th5)) + cos(th6)*sin(th4) + 0*000000000061232339957367574077026692924754*sin(th4)*(0*000000000061232339957367574077026692924754*cos(th5)*cos(th6) - 1.0*sin(th5)*sin(th6))) + sin(th3)*(cos(th4)*cos(th6) - 1.0*sin(th4)*(cos(th5)*sin(th6) + 0*000000000061232339957367574077026692924754*cos(th6)*sin(th5)) + 0*000000000061232339957367574077026692924754*cos(th4)*(0*000000000061232339957367574077026692924754*cos(th5)*cos(th6) - 1.0*sin(th5)*sin(th6)))),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          0*000000000061232339957367574077026692924754*cos(th5)*cos(th6) - 0*000000000061232339957367574077026692924754*cos(th6) - 1.0*sin(th5)*sin(th6),                                                                                                                                                                                                                                                                                                                                                                            0*000000000061232339957367574077026692924754*cos(th5)*cos(th6) - 0*000000000061232339957367574077026692924754*cos(th6) - 1.0*sin(th5)*sin(th6),                  0*000000000061232339957367574077026692924754*cos(th5)*cos(th6) - 0*000000000061232339957367574077026692924754*cos(th6) - 1.0*sin(th5)*sin(th6),                                      -1.0*cos(th6),   0];...
[                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               0*000000000061232339957367574077026692924754*cos(th5) - 1.0*sin(th2)*(cos(th3)*(cos(th4)*sin(th5) - 0*000000000061232339957367574077026692924754*sin(th4) + 0*000000000061232339957367574077026692924754*cos(th5)*sin(th4)) - 1.0*sin(th3)*(0*000000000061232339957367574077026692924754*cos(th4) - 0*000000000061232339957367574077026692924754*cos(th4)*cos(th5) + sin(th4)*sin(th5))) - 1.0*cos(th2)*(cos(th3)*(0*000000000061232339957367574077026692924754*cos(th4) - 0*000000000061232339957367574077026692924754*cos(th4)*cos(th5) + sin(th4)*sin(th5)) + sin(th3)*(cos(th4)*sin(th5) - 0*000000000061232339957367574077026692924754*sin(th4) + 0*000000000061232339957367574077026692924754*cos(th5)*sin(th4))) + 2.2958450216584849647377114753717e-49,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    cos(th5) + 3.7493994566544195928818807323743e-33,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      cos(th5) + 3.7493994566544195928818807323743e-33,                                                                                                                            cos(th5) + 3.7493994566544195928818807323743e-33, 0*000000000061232339957367574077026692924754, 1.0];...
];
%%
%This is crazy slow
J_hacky = simplify(J_hacky);
J_hacky = simplify(J_hacky);
pretty(J_hacky)

%%
J_sym_inv=inv(Jsym);




